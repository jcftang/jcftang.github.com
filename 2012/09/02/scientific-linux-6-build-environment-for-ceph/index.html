<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.29" />

  <title>scientific linux 6 build environment for ceph &middot; Jimmy Tang</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="http://jcftang.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="http://jcftang.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="http://jcftang.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="http://jcftang.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://jcftang.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://jcftang.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://jcftang.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/jcftang" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://plus.google.com/+JimmyTang" target="_blank"><i class="fa fa-google-plus-square fa-fw"></i>Google+</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/jimmy-tang-1b54322" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/jcftang" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small></small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>scientific linux 6 build environment for ceph</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>02 Sep 2012, 00:00</time>
  </div>

  

  

  

</div>

  

<p>After my last failed attempt at <a href="http://jcftang.github.io/2012/07/06/installing-ceph-on-sl6/">Installing Ceph on
SL6</a> or rather my attempt at
configuring Ceph for a test failed miserably.</p>

<p>It hasn&rsquo;t deterred me to test more. As a result I setup a number of
Vagrant Virtual machines and got together a few puppet scripts to
provision machines.</p>

<p>Here&rsquo;s a sample manifest for puppet to automate the deployment of a
machine to build Ceph. It requires that you SL6 environment to have at
least the epel repository enabled.</p>

<pre><code>
# -*- mode: ruby -*-
# vi: set ft=ruby :

#
# template for tchpc site, there are dependancy issues with proxies
#
node /ceph.*\.localhost/ inherits default {
    # install needed packages
        # generic devel tools and libraries
        if ! defined(Package['nfs-utils']) { package { 'nfs-utils': ensure =&gt; installed } }
    if ! defined(Package['boost-devel']) { package { 'boost-devel': ensure =&gt; installed } }
    if ! defined(Package['epel-release']) { package { 'epel-release': ensure =&gt; installed } }
    if ! defined(Package['expat-devel']) { package { 'expat-devel': ensure =&gt; installed } }
    if ! defined(Package['fuse']) { package { 'fuse': ensure =&gt; installed } }
    if ! defined(Package['fuse-devel']) { package { 'fuse-devel': ensure =&gt; installed } }
    if ! defined(Package['gcc']) { package { 'gcc': ensure =&gt; installed } }
    if ! defined(Package['gcc-c++']) { package { 'gcc-c++': ensure =&gt; installed } }
    if ! defined(Package['keyutils-libs-devel']) { package { 'keyutils-libs-devel': ensure =&gt; installed } }
    if ! defined(Package['libaio-devel']) { package { 'libaio-devel': ensure =&gt; installed } }
    if ! defined(Package['libatomic_ops-devel']) { package { 'libatomic_ops-devel': ensure =&gt; installed } }
    if ! defined(Package['libcurl-devel']) { package { 'libcurl-devel': ensure =&gt; installed } }
    if ! defined(Package['libedit-devel']) { package { 'libedit-devel': ensure =&gt; installed } }
    if ! defined(Package['libtool']) { package { 'libtool': ensure =&gt; installed } }
    if ! defined(Package['libuuid-devel']) { package { 'libuuid-devel': ensure =&gt; installed } }
    if ! defined(Package['libxml2-devel']) { package { 'libxml2-devel': ensure =&gt; installed } }
    if ! defined(Package['nss']) { package { 'nss': ensure =&gt; installed } }
    if ! defined(Package['nss-devel']) { package { 'nss-devel': ensure =&gt; installed } }
    if ! defined(Package['rpmdevtools']) { package { 'rpmdevtools': ensure =&gt; installed } }
        if ! defined(Package['git']) { package { 'git': ensure =&gt; installed } }

    # these two are form EPEL
    if ! defined(Package['gperftools-devel']) { package { 'gperftools-devel': ensure =&gt; installed } }
    if ! defined(Package['fcgi-devel']) { package { 'fcgi-devel': ensure =&gt; installed } }

    # turn on avahi so we can do things like  "ssh ceph00.local" between the vm's
    include avahi

    # take the vagrant key for now and use it for passwordless ssh configs
        ssh_authorized_key { "root":
                ensure =&gt; "present",
                type =&gt; "ssh-rsa",
                key =&gt; "AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ==",
                name =&gt; "vagrant insecure public key",
                user =&gt; "root",
        }

        file { "/root/.ssh/id_rsa":
                mode =&gt; "0600",
                owner =&gt; "root",
                group =&gt; "root",
                source =&gt; "puppet:///modules/insecure-keys/insecure_private_key" ,
                require =&gt; Ssh_authorized_key["root"],
        }

        file { "/root/.ssh/config":
                mode =&gt; "0600",
                owner =&gt; "root",
                group =&gt; "root",
                source =&gt; "puppet:///modules/insecure-keys/insecure_config",
                require =&gt; Ssh_authorized_key["root"],
        }

    # the follow is done so the vagrant user can be used for testing and development without needing to su to the cephuser account
    file { "/home/vagrant/.ssh/id_rsa":
        mode =&gt; "0600",
        owner =&gt; "vagrant",
        group =&gt; "vagrant",
        source =&gt; "puppet:///modules/insecure-keys/insecure_private_key" ,
    }

    file { "/home/vagrant/.ssh/config":
        mode =&gt; "0600",
        owner =&gt; "vagrant",
        group =&gt; "vagrant",
        source =&gt; "puppet:///modules/insecure-keys/insecure_config",
    }

    # define the hosts in /etc/hosts
    host { 'ceph00': ip =&gt; '10.0.1.130', host_aliases =&gt; 'ceph00', }
    host { 'ceph01': ip =&gt; '10.0.1.131', host_aliases =&gt; 'ceph01', }
    host { 'ceph02': ip =&gt; '10.0.1.132', host_aliases =&gt; 'ceph02', }

    # disable selinux
    class { 'selinux':
        mode =&gt; 'disabled',
    }
}
</code></pre>

<p>Here&rsquo;s also a sample <em>Vagrantfile</em> to get one started</p>

<p>{% codeblock Vagrantfile lang:ruby %}</p>

<h1 id="mode-ruby">-<em>- mode: ruby -</em>-</h1>

<h1 id="vi-set-ft-ruby">vi: set ft=ruby :</h1>

<p>#</p>

<h1 id="for-vagrant-configuration-options-please-go-to-http-vagrantup-com-v1-docs-index-html">For vagrant configuration options please go to <a href="http://vagrantup.com/v1/docs/index.html">http://vagrantup.com/v1/docs/index.html</a></h1>

<p>#</p>

<p>Vagrant::Config.run do |global_config|
  # All Vagrant configuration is done here. The most common configuration
  # options are documented and commented below. For a complete reference,
  # please see the online documentation at vagrantup.com.</p>

<p># Every Vagrant virtual environment requires a box to build off of.
  # We default to using SL which is a RHEL clone
  global_config.vm.box = &ldquo;sl63-x86_64&rdquo;
  global_config.vm.box_url = &ldquo;<a href="http://thammuz.tchpc.tcd.ie/mirrors/boxes/scientificlinux-6.3-x86_64-netboot-devops.box&quot;">http://thammuz.tchpc.tcd.ie/mirrors/boxes/scientificlinux-6.3-x86_64-netboot-devops.box&quot;</a>
  cephServers.each do |name, opts|
    global_config.vm.define name do |ceph|
      # uncomment the following line if you want the basebox to start in gui mode
      #ceph.vm.boot_mode = :gui
      ceph.vm.network :hostonly, opts[:network]
      ceph.vm.host_name = opts[:host_name]</p>

<pre><code>  ceph.vm.provision :puppet, :facter =&gt; { &quot;ceph_node_name&quot; =&gt; &quot;ceph@#{opts[:network]}&quot; } do |puppet|
    puppet.manifest_file = &quot;site.pp&quot;
    puppet.manifests_path = 'puppet/manifests'
    puppet.module_path = ['puppet/modules', 'puppet/services']
    #puppet.options = &quot;--verbose --debug&quot;
  end

ceph.vm.customize [
  &quot;modifyvm&quot;, :id,
  &quot;--name&quot;, opts[:host_name],
  &quot;--memory&quot;, &quot;1024&quot;
]

end
</code></pre>

<p>end</p>

<p>end</p>

<p>{% endcodeblock %}</p>

<p>With the Virtual Machines I was able to download the latest <a href="http://www.ceph.com/download/ceph-0.51.tar.bz2">Ceph
0.51</a> and do at least
the following</p>

<ul>
<li>unpack the tarball</li>
<li>do a <em>./configure</em> to generate the <em>ceph.spec</em> file</li>
<li>copy (or move) the ceph tarball into ~/rpmbuild/SOURCES</li>
<li>execute a <em>rpmbuild -ba ceph.spec</em> to build the source and binary rpm packages for installation</li>
</ul>

<p>After the RPM&rsquo;s were built and installed, I again followed the quick
guide at <a href="http://ceph.com/docs/master/start/quick-start/">http://ceph.com/docs/master/start/quick-start/</a> and was able
to setup a small 3 node cluster for playing around with.</p>

<p>So to note, I tried out the cephfs feature (via the fuse module) and
creating(destroying and resizing) RBD&rsquo;s. I haven&rsquo;t had a chance to
experiment with the kernel modules to actually do something useful with
the POSIX filesystem or RBD&rsquo;s that Ceph provides.</p>

<p>It would be worth nothing that the Ceph project are working on providing
prebuilt RPM&rsquo;s soon, there is already a <a href="http://ceph.com/gitbuilder-centos6-rpm-amd64/">gitbuilder instance for the rpm
build</a> or just go to their
<a href="http://ceph.com/gitbuilder.cgi">gitbuilder aggregator</a></p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="http://jcftang.github.io/2012/09/01/rce-62-ceph-petabyte-scale-storage/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="http://jcftang.github.io/2012/09/01/rce-62-ceph-petabyte-scale-storage/">rce 62 ceph petabyte scale storage</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="http://jcftang.github.io/2012/09/04/adding-an-osd-to-a-ceph-cluster/">adding an osd to a ceph cluster</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="http://jcftang.github.io/2012/09/04/adding-an-osd-to-a-ceph-cluster/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  AAAA



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'jcftang';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</div>
</div>
<script src="http://jcftang.github.io/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8597777-2', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>

